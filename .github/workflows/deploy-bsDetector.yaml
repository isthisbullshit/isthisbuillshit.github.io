name: deploy-bsdetector
on: 
  push:
    paths:
      - .github/workflows/deploy-bsDetector.yaml
      - bsDetector/**

jobs:

  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: build docker image
        run:
          cd bsDetector && docker build . -t localhost:5000/bsDetector
      - name: upload docker image
        run:
          echo ${{ secrets.BACKEND_SSH_KEY }} | ssh -M -S server-socket -fnNT -L 5000:${{ secrets.BACKEND_SSH_HOST }}:5000 ${{ secrets.BACKEND_SSH_USERNAME }}@${{ secrets.BACKEND_SSH_HOST }}
          docker push localhost:5000/bsDetector
          ssh -S server-socket -O exit ${{ secrets.BACKEND_SSH_USERNAME }}@${{ secrets.BACKEND_SSH_HOST }}